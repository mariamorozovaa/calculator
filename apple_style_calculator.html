<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Калькулятор (Apple-style)</title>
  <style>
    :root{
      --bg:#1e1e1f;
      --panel:#2c2c2e;
      --display:#1c1c1e;
      --digit-bg:#333335;
      --op-bg:#ff9f0a;
      --func-bg:rgba(142,142,147,0.24);
      --txt-light:#fff;
      --txt-dark:#000;
      --glass: rgba(255,255,255,0.06);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;}
    body{
      margin:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#0f0f10 0%, #121213 100%);padding:20px;
    }
    .calc{
      width:360px;max-width:96vw;border-radius:36px;background:linear-gradient(180deg,var(--panel), #141416);box-shadow: 0 10px 30px rgba(0,0,0,0.6), inset 0 1px rgba(255,255,255,0.02);padding:20px;
    }
    .display{
      height:110px;background:linear-gradient(180deg,var(--display), #0b0b0b);border-radius:22px;color:var(--txt-light);display:flex;flex-direction:column;align-items:flex-end;justify-content:center;padding:18px 18px 14px;box-sizing:border-box;margin-bottom:18px;font-weight:200;
    }
    .history{font-size:14px;opacity:0.6;color:#c7c7cc;margin-bottom:6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}
    .result{font-size:48px;line-height:1;}
    .keys{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    button{
      height:76px;border-radius:38px;border:0;outline:0;font-size:28px;cursor:pointer;box-shadow: 0 6px 0 rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;user-select:none;
      transition:transform 0.08s linear, box-shadow 0.08s linear;
    }
    button:active{transform:translateY(3px);box-shadow: 0 3px 0 rgba(0,0,0,0.35)}

    .btn-func{background:var(--func-bg);color:var(--txt-light);backdrop-filter: blur(6px);}
    .btn-op{background:linear-gradient(180deg,var(--op-bg), #ff8b00);color:var(--txt-dark);font-weight:600}
    .btn-digit{background:linear-gradient(180deg,var(--digit-bg), #2a2a2c);color:var(--txt-light)}
    .btn-zero{grid-column:span 2;border-radius:38px;display:flex;justify-content:flex-start;padding-left:36px}

    /* smaller screens */
    @media (max-width:420px){
      .calc{width:320px}
      button{height:64px;font-size:24px}
      .display{height:94px}
      .result{font-size:40px}
    }
  </style>
</head>
<body>
  <div class="calc" role="application" aria-label="Калькулятор">
    <div class="display" id="display">
      <div class="history" id="history">&nbsp;</div>
      <div class="result" id="result">0</div>
    </div>

    <div class="keys" id="keys">
      <button class="btn-func" data-action="clear">AC</button>
      <button class="btn-func" data-action="plusminus">±</button>
      <button class="btn-func" data-action="percent">%</button>
      <button class="btn-op" data-action="operator" data-value="/">÷</button>

      <button class="btn-digit" data-value="7">7</button>
      <button class="btn-digit" data-value="8">8</button>
      <button class="btn-digit" data-value="9">9</button>
      <button class="btn-op" data-action="operator" data-value="*">×</button>

      <button class="btn-digit" data-value="4">4</button>
      <button class="btn-digit" data-value="5">5</button>
      <button class="btn-digit" data-value="6">6</button>
      <button class="btn-op" data-action="operator" data-value="-">−</button>

      <button class="btn-digit" data-value="1">1</button>
      <button class="btn-digit" data-value="2">2</button>
      <button class="btn-digit" data-value="3">3</button>
      <button class="btn-op" data-action="operator" data-value="+">+</button>

      <button class="btn-digit btn-zero" data-value="0">0</button>
      <button class="btn-digit" data-action="decimal">.</button>
      <button class="btn-op" data-action="equals">=</button>
    </div>
  </div>

  <script>
    (function(){
      const display = document.getElementById('result');
      const history = document.getElementById('history');
      const keys = document.getElementById('keys');

      let current = '0';
      let previous = null;
      let operator = null;
      let waiting = false;

      function updateDisplay(){
        display.textContent = formatNumber(current);
        history.textContent = previous !== null ? (formatNumber(previous) + (operator ? ' ' + mapOp(operator) : '')) : '\u00A0';
      }

      function formatNumber(str){
        // try to keep as typed; format big numbers with spaces
        if (str === 'Error') return 'Error';
        if (Math.abs(Number(str)) >= 1e10) return Number(str).toExponential(6);
        const parts = str.split('.');
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        return parts.join('.')
      }

      function mapOp(op){
        return op === '*' ? '×' : op === '/' ? '÷' : op;
      }

      keys.addEventListener('click', (e)=>{
        const btn = e.target.closest('button');
        if(!btn) return;
        const val = btn.dataset.value;
        const action = btn.dataset.action || (btn.classList.contains('btn-digit') ? 'digit' : null);

        switch(action){
          case 'digit': inputDigit(val); break;
          case 'decimal': inputDecimal(); break;
          case 'operator': handleOperator(btn.dataset.value); break;
          case 'equals': performEquals(); break;
          case 'clear': clearAll(); break;
          case 'plusminus': toggleSign(); break;
          case 'percent': toPercent(); break;
        }
        updateDisplay();
      });

      // keyboard support
      window.addEventListener('keydown', (e)=>{
        if (e.key >= '0' && e.key <= '9') { inputDigit(e.key); updateDisplay(); return }
        if (e.key === '.') { inputDecimal(); updateDisplay(); return }
        if (['+','-','*','/'].includes(e.key)) { handleOperator(e.key); updateDisplay(); return }
        if (e.key === 'Enter' || e.key === '=') { performEquals(); updateDisplay(); return }
        if (e.key === 'Backspace') { backspace(); updateDisplay(); return }
        if (e.key.toLowerCase() === 'c') { clearAll(); updateDisplay(); return }
      })

      function inputDigit(d){
        if(waiting){
          current = d;
          waiting = false;
        } else {
          if (current === '0') current = d;
          else current = current + d;
        }
      }
      function inputDecimal(){
        if(waiting){ current = '0.'; waiting = false; return }
        if(!current.includes('.')) current += '.';
      }
      function handleOperator(op){
        if (operator && !waiting) {
          // chain compute
          const res = compute(previous, current, operator);
          previous = res;
        } else if (!operator) {
          previous = current;
        }
        operator = op;
        waiting = true;
        current = String(previous);
      }
      function performEquals(){
        if(!operator || previous === null) return;
        const res = compute(previous, current, operator);
        current = String(res);
        previous = null;
        operator = null;
        waiting = true;
      }

      function compute(a,b,op){
        const x = Number(a);
        const y = Number(b);
        if (isNaN(x) || isNaN(y)) return 'Error';
        let r;
        switch(op){
          case '+': r = x + y; break;
          case '-': r = x - y; break;
          case '*': r = x * y; break;
          case '/': r = y === 0 ? NaN : x / y; break;
          default: r = NaN;
        }
        if (!isFinite(r) || isNaN(r)) return 'Error';
        // trim floating precision
        r = roundIfNeeded(r);
        return String(r);
      }
      function roundIfNeeded(n){
        // limit to 10 decimal places to avoid long floats
        return Math.round((n + Number.EPSILON) * 1e10) / 1e10;
      }

      function clearAll(){ current = '0'; previous = null; operator = null; waiting = false }
      function toggleSign(){ if (current === '0') return; if (current.startsWith('-')) current = current.slice(1); else current = '-' + current }
      function toPercent(){ current = String(Number(current) / 100); }
      function backspace(){ if (waiting) return; if (current.length <= 1) current = '0'; else current = current.slice(0,-1) }

      // init
      updateDisplay();
    })();
  </script>
</body>
</html>
